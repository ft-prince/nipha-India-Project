<!-- templates/bom_slider_fragment.html - ENHANCED WITH SPLIT DISPLAY LOGIC -->
<div class="bom-container-slider">
    <style>
        .bom-container-slider {
            width: 100%;
            height: 100vw; /* CHANGED: Use viewport width for rotated display */
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%); /* CHANGED: Much darker background */
            color: white;
            overflow: hidden;
            position: relative;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
        }
        
        .bom-header-slider {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            padding: 20px 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }
        
        .bom-title-slider {
            font-size: 2.8em; /* Slightly reduced to save space */
            font-weight: bold;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .bom-subtitle-slider {
            font-size: 1.4em;
            margin: 8px 0 0 0;
            opacity: 0.9;
        }
        
        /* NEW: Split display indicator */
        .split-indicator {
            background: rgba(255, 165, 0, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1.0em;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .split-indicator.stage-bom {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .bom-info-slider {
            display: flex;
            justify-content: space-around;
            padding: 15px 30px;
            background: rgba(0,0,0,0.6); /* CHANGED: Much darker info section */
            border-bottom: 2px solid rgba(255,255,255,0.2); /* INCREASED: More visible border */
            flex-shrink: 0;
        }
        
        .bom-info-item {
            text-align: center;
        }
        
        .bom-info-label {
            font-size: 1.0em;
            opacity: 0.8;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .bom-info-value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .bom-table-container-slider {
            flex: 1;
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .bom-table-slider {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.98); /* INCREASED: More opaque white background */
            color: #1a1a1a; /* CHANGED: Darker text for better contrast */
            flex: 1;
            display: table;
            table-layout: fixed; /* CRITICAL: Fixed layout for consistent column widths */
            font-size: calc(1.4rem + 0.8vw); /* INCREASED: Much larger base font size */
            box-shadow: 0 0 20px rgba(0,0,0,0.3); /* ADDED: Table shadow for depth */
        }
        
        .bom-table-slider th {
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%); /* CHANGED: Dark header background */
            color: white;
            padding: 18px 12px; /* INCREASED: Much larger padding */
            text-align: center;
            font-weight: bold;
            font-size: calc(1.6rem + 0.6vw); /* INCREASED: Much larger header font size */
            border-bottom: 4px solid #444; /* INCREASED: Thicker border */
            border-right: 2px solid rgba(255,255,255,0.3); /* INCREASED: More visible border */
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7); /* INCREASED: Stronger text shadow */
        }
        
        .bom-table-slider td {
            padding: 16px 10px; /* INCREASED: Much larger padding */
            border-bottom: 3px solid #ddd; /* INCREASED: Much thicker border */
            border-right: 3px solid #ddd; /* INCREASED: Much thicker border */
            vertical-align: middle;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: calc(1.2rem + 0.6vw); /* ADDED: Explicit larger font size for tbody */
            line-height: 1.4; /* ADDED: Better line spacing */
        }
        
        .bom-table-slider tbody {
            display: table-row-group;
        }
        
        .bom-table-slider tbody tr {
            display: table-row;
            height: calc((100vw - 220px) / var(--visible-rows, 8)); /* CHANGED: Use viewport width for rotated display */
        }
        
        .bom-table-slider tbody tr:nth-child(even) {
            background-color: rgba(245, 245, 245, 0.98); /* CHANGED: Lighter and more opaque even rows */
        }
        
        .bom-table-slider tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.3); /* INCREASED: Stronger blue hover */
            transform: scale(1.002); /* INCREASED: Slightly more scale */
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); /* INCREASED: Stronger hover shadow */
        }
        
        /* COLUMN SPECIFIC STYLES - Auto-adjusting based on number of columns */
        /* ENHANCED: Special emphasis on photo and description columns */
        
        /* For 5 columns - PHOTO MOVED TO LAST POSITION */
        .bom-table-slider.cols-5 th:nth-child(1), /* S.NO */
        .bom-table-slider.cols-5 td:nth-child(1) {
            width: 8%; /* REDUCED: Make serial number smaller */
        }
        
        .bom-table-slider.cols-5 th:nth-child(2), /* DESCRIPTION */
        .bom-table-slider.cols-5 td:nth-child(2) {
            width: 35%; /* INCREASED: Much larger description column */
        }
        
        .bom-table-slider.cols-5 th:nth-child(3), /* PART NO */
        .bom-table-slider.cols-5 td:nth-child(3) {
            width: 17%; /* ADJUSTED: Medium part number column */
        }
        
        .bom-table-slider.cols-5 th:nth-child(4), /* QTY */
        .bom-table-slider.cols-5 td:nth-child(4) {
            width: 12%; /* ADJUSTED: Smaller quantity column */
        }
        
        .bom-table-slider.cols-5 th:nth-child(5), /* PHOTO - NOW LAST */
        .bom-table-slider.cols-5 td:nth-child(5) {
            width: 28%; /* INCREASED: Much larger photo column */
        }
        
        /* For 6 columns */
        .bom-table-slider.cols-6 th,
        .bom-table-slider.cols-6 td {
            width: 16.67%;
        }
        
        .bom-table-slider.cols-6 th:nth-child(2), /* DESCRIPTION */
        .bom-table-slider.cols-6 td:nth-child(2) {
            width: 26%; /* INCREASED: Larger description column for 6 cols */
        }
        
        .bom-table-slider.cols-6 th:nth-child(6), /* PHOTO - LAST */
        .bom-table-slider.cols-6 td:nth-child(6) {
            width: 22%; /* INCREASED: Larger photo column for 6 cols */
        }
        
        /* SPECIAL COLUMN STYLES */
        .serial-number-slider {
            font-weight: bold;
            color: #1a1a1a; /* CHANGED: Darker text */
            background: #f5f5f5; /* CHANGED: Lighter background for better contrast */
            font-size: calc(1.8rem + 0.8vw) !important; /* FORCED: Same as item-description-slider with !important */
            min-width: 60px; /* REDUCED: Smaller serial number column */
        }
        
        .item-photo-slider {
            width: calc(180px + 6vw); /* MASSIVELY INCREASED: Much larger photos */
            height: calc(180px + 6vw);
            max-width: 350px; /* MASSIVELY INCREASED: Much larger maximum size */
            max-height: 350px;
            object-fit: contain;
            border-radius: 12px; /* INCREASED: More rounded corners */
            border: 4px solid #bdc3c7; /* INCREASED: Thicker border */
            box-shadow: 0 6px 12px rgba(0,0,0,0.3); /* INCREASED: Stronger shadow */
            display: block;
            margin: 8px auto; /* INCREASED: More margin */
        }
        
        .item-photo-placeholder-slider {
            width: calc(180px + 6vw); /* MASSIVELY INCREASED: Much larger placeholder */
            height: calc(180px + 6vw);
            max-width: 350px; /* MASSIVELY INCREASED: Much larger maximum size */
            max-height: 350px;
            background: #e0e0e0; /* CHANGED: Lighter placeholder background */
            border: 4px dashed #999; /* INCREASED: Thicker dashed border */
            border-radius: 12px; /* INCREASED: More rounded corners */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555; /* CHANGED: Darker placeholder text */
            font-size: calc(1.4rem + 0.6vw); /* MASSIVELY INCREASED: Much larger placeholder text */
            text-align: center;
            margin: 8px auto; /* INCREASED: More margin */
            font-weight: bold;
        }
        
        .photo-column {
            text-align: center;
            min-width: calc(200px + 6vw); /* MASSIVELY INCREASED: Much wider photo column */
            max-width: calc(380px + 6vw); /* ADDED: Maximum width for photo column */
        }
        
        .item-description-slider {
            font-weight: bold;
            color: #1a1a1a; /* CHANGED: Much darker text for better contrast */
            margin-bottom: 8px; /* INCREASED: More spacing */
            font-size: calc(1.8rem + 0.8vw); /* MASSIVELY INCREASED: Much larger description font */
            line-height: 1.4; /* INCREASED: Better line spacing */
            white-space: normal; /* Allow wrapping for descriptions */
            overflow: visible;
            text-overflow: clip;
            text-align: left; /* ADDED: Left align for better readability */
            padding: 4px 8px; /* ADDED: Padding for better spacing */
        }
        
        .item-code-slider {
            font-size: calc(1.4rem + 0.6vw); /* MASSIVELY INCREASED: Much larger code font */
            color: #444; /* CHANGED: Darker code text */
            font-family: 'Courier New', monospace;
            font-weight: 600; /* ADDED: Semi-bold for better visibility */
            text-align: left; /* ADDED: Left align for better readability */
            padding: 2px 8px; /* ADDED: Padding for better spacing */
            background: rgba(240,240,240,0.8); /* ADDED: Light background for code */
            border-radius: 4px; /* ADDED: Rounded corners for code */
            margin-top: 4px; /* ADDED: Margin for separation */
        }
        
        .description-column {
            text-align: left;
            white-space: normal;
            overflow: visible;
            min-width: calc(220px + 8vw); /* MASSIVELY INCREASED: Much wider description column */
            max-width: calc(450px + 8vw); /* ADDED: Maximum width for description column */
            padding: 12px 16px; /* INCREASED: More padding for descriptions */
        }
        
        .part-number-slider {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #d32f2f; /* CHANGED: Darker red for better contrast */
            font-size: calc(1.8rem + 0.8vw) !important; /* FORCED: Same as item-description-slider with !important */
        }
        
        .quantity-slider {
            font-size: calc(1.8rem + 0.8vw) !important; /* FORCED: Same as item-description-slider with !important */
            font-weight: bold;
            color: #1b5e20; /* CHANGED: Darker green for better contrast */
        }
        
        .no-bom-data-slider {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            color: rgba(255,255,255,0.8);
        }
        
        .no-bom-icon-slider {
            font-size: 6em;
            margin-bottom: 30px;
            opacity: 0.6;
        }
        
        .no-bom-data-slider h3 {
            font-size: 2.2em;
            margin-bottom: 20px;
        }
        
        .no-bom-data-slider p {
            font-size: 1.3em;
            margin: 10px 0;
        }
        
        .bom-watermark {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: calc(0.8rem + 0.2vw);
            opacity: 0.9; /* INCREASED: More visible watermark */
            background: rgba(0,0,0,0.8); /* CHANGED: Darker watermark background */
            color: white; /* ADDED: White text for contrast */
            padding: 8px 15px; /* INCREASED: Larger padding */
            border-radius: 10px; /* INCREASED: More rounded */
            border: 1px solid rgba(255,255,255,0.2); /* ADDED: Subtle border */
        }
        
        .stage-indicator {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.6em;
            display: inline-block;
            margin-left: 12px;
        }
        
        /* NEW: No items message for split displays */
        .no-items-message {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            color: rgba(255,255,255,0.8);
            background: rgba(52, 152, 219, 0.1);
            border: 2px dashed rgba(52, 152, 219, 0.3);
            border-radius: 20px;
            margin: 20px;
        }
        
        .no-items-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.6;
        }
        
        .no-items-message h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .no-items-message p {
            font-size: 1.1em;
            margin: 5px 0;
        }
        
        /* RESPONSIVE BREAKPOINTS FOR ROTATED DISPLAY */
        
        /* Large screens (1920px+) - ROTATED */
        @media screen and (min-width: 1920px) {
            .bom-table-slider {
                font-size: calc(1.6rem + 0.6vw); /* INCREASED: Even larger fonts for rotated display */
            }
            .bom-table-slider th {
                font-size: calc(1.8rem + 0.4vw); /* INCREASED: Larger headers */
                padding: 20px 15px; /* INCREASED: More padding */
            }
            .bom-table-slider td {
                font-size: calc(1.4rem + 0.4vw); /* INCREASED: Larger cell text */
                padding: 18px 12px; /* INCREASED: More padding */
            }
            .item-photo-slider, .item-photo-placeholder-slider {
                width: calc(220px + 5vw); /* MASSIVELY INCREASED: Even larger images */
                height: calc(220px + 5vw);
                max-width: 400px; /* MASSIVELY INCREASED: Much larger maximum */
                max-height: 400px;
            }
            .serial-number-slider {
                font-size: calc(2.0rem + 0.6vw) !important; /* FORCED: Same as item-description-slider for large screens with !important */
            }
            .item-description-slider {
                font-size: calc(2.0rem + 0.6vw); /* MASSIVELY INCREASED: Much larger descriptions */
            }
            .item-code-slider {
                font-size: calc(1.6rem + 0.4vw); /* MASSIVELY INCREASED: Much larger code text */
            }
            .part-number-slider {
                font-size: calc(2.0rem + 0.6vw) !important; /* FORCED: Same as item-description-slider for large screens with !important */
            }
            .quantity-slider {
                font-size: calc(2.0rem + 0.6vw) !important; /* FORCED: Same as item-description-slider for large screens with !important */
            }
        }
        
        /* Extra large screens (2560px+) - ROTATED */
        @media screen and (min-width: 2560px) {
            .bom-title-slider { font-size: 4em; /* INCREASED */ }
            .bom-subtitle-slider { font-size: 2.2em; /* INCREASED */ }
            .bom-info-value { font-size: 2.8em; /* INCREASED */ }
            .bom-table-slider {
                font-size: calc(1.8rem + 0.4vw); /* INCREASED */
            }
            .bom-table-slider th {
                font-size: calc(2.0rem + 0.3vw); /* INCREASED: Much larger headers */
                padding: 24px 18px; /* INCREASED: Even more padding */
            }
            .bom-table-slider td {
                font-size: calc(1.6rem + 0.3vw); /* INCREASED: Much larger cell text */
                padding: 20px 15px; /* INCREASED: Even more padding */
            }
            .item-photo-slider, .item-photo-placeholder-slider {
                width: calc(260px + 4vw); /* MASSIVELY INCREASED: Massive photos */
                height: calc(260px + 4vw);
                max-width: 450px; /* MASSIVELY INCREASED: Much larger maximum */
                max-height: 450px;
            }
            .serial-number-slider {
                font-size: calc(2.4rem + 0.5vw) !important; /* FORCED: Same as item-description-slider for extra large screens with !important */
            }
            .item-description-slider {
                font-size: calc(2.4rem + 0.5vw); /* MASSIVELY INCREASED: Massive descriptions */
            }
            .item-code-slider {
                font-size: calc(1.8rem + 0.3vw); /* MASSIVELY INCREASED: Massive code text */
            }
            .part-number-slider {
                font-size: calc(2.4rem + 0.5vw) !important; /* FORCED: Same as item-description-slider for extra large screens with !important */
            }
            .quantity-slider {
                font-size: calc(2.4rem + 0.5vw); /* MATCHED: Same as item-description-slider for extra large screens */
            }
        }
        
        /* DYNAMIC ROW SIZING BASED ON DATA COUNT - ROTATED DISPLAY */
        .bom-table-container-slider[data-row-count="1"] .bom-table-slider tbody tr { height: calc(100vw - 220px); }
        .bom-table-container-slider[data-row-count="2"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 2); }
        .bom-table-container-slider[data-row-count="3"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 3); }
        .bom-table-container-slider[data-row-count="4"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 4); }
        .bom-table-container-slider[data-row-count="5"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 5); }
        .bom-table-container-slider[data-row-count="6"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 6); }
        .bom-table-container-slider[data-row-count="7"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 7); }
        .bom-table-container-slider[data-row-count="8"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 8); }
        .bom-table-container-slider[data-row-count="9"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 9); }
        .bom-table-container-slider[data-row-count="10"] .bom-table-slider tbody tr { height: calc((100vw - 220px) / 10); }
        
        /* For more rows, set minimum readable height */
        .bom-table-container-slider[data-row-count] .bom-table-slider tbody tr {
            min-height: 120px; /* MASSIVELY INCREASED: Much larger minimum height for better image/text visibility */
            height: max(120px, calc((100vw - 220px) / var(--row-count, 8)));
        }
    </style>
    
    {% if bom_data %}
    <div class="bom-header-slider">
        <h1 class="bom-title-slider">
            Bill of Material
        </h1>
        
        {% if is_split %}
            <div class="split-indicator">
                üìã Display {{ station.display_number }} of 3 - Split BOM
            </div>
        {% elif bom_info.type == 'stage_specific' %}
            <div class="split-indicator stage-bom">
                üéØ {{ bom_info.display_name }} - Complete BOM
            </div>
        {% endif %}
    </div>
    
    <div class="bom-info-slider">
        <div class="bom-info-item">
            <div class="bom-info-label">TYPE</div>
            <div class="bom-info-value">{{ bom_type }}</div>
        </div>
        <div class="bom-info-item">
            <div class="bom-info-label">QUANTITY</div>
            <div class="bom-info-value">{{ quantity }}</div>
        </div>
        <div class="bom-info-item">
            <div class="bom-info-label">ITEMS</div>
            <div class="bom-info-value">{{ bom_data|length }}</div>
        </div>
        <div class="bom-info-item">
            <div class="bom-info-label">DISPLAY</div>
            <div class="bom-info-value">{{ station.display_number }}{% if is_split %}/3{% endif %}</div>
        </div>
    </div>
    
    {% if bom_data|length > 0 %}
    <div class="bom-table-container-slider" data-row-count="{{ bom_data|length }}">
        <table class="bom-table-slider cols-5">
            <thead>
                <tr>
                    <th class="serial-number-slider">S.NO</th>
                    <th class="description-column">DESCRIPTION</th>
                    <th class="part-number-slider">PART NO.</th>
                    <th class="quantity-slider">QTY</th>
                    <th class="photo-column">PHOTO</th>
                </tr>
            </thead>
            <tbody>
                {% for item_data in bom_data %}
                <tr>
                    <td class="serial-number-slider">{{ item_data.serial_number|stringformat:"02d" }}</td>
                    <td class="description-column">
                        <div class="item-description-slider">{{ item_data.item.item_description }}</div>
                        <div class="item-code-slider">{{ item_data.item.item_code }}</div>
                    </td>
                    <td class="part-number-slider">{{ item_data.item.part_number }}</td>
                    <td class="quantity-slider">{{ item_data.formatted_quantity }}</td>
                    <td class="photo-column">
                        {% if item_data.item.item_photo %}
                        <img src="{{ item_data.item.item_photo.url }}" 
                             alt="{{ item_data.item.item_description }}" 
                             class="item-photo-slider">
                        {% else %}
                        <div class="item-photo-placeholder-slider">
                            NO<br>PHOTO
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-items-message">
        <div class="no-items-icon">üìã</div>
        <h3>No Items for Display {{ station.display_number }}</h3>
        <p>This display section has no BOM items assigned.</p>
        <p>Check other displays for remaining items.</p>
    </div>
    {% endif %}
    
    <div class="bom-watermark">
        üè≠ Display {{ station.display_number }}{% if is_split %} of 3{% endif %} ‚Ä¢ {% if is_split %}Split {% endif %}BOM ‚Ä¢ {{ bom_data|length }} Items
        {% if bom_info.display_info %}
        <br>{{ bom_info.display_info }}
        {% endif %}
    </div>
    
    {% else %}
    <div class="no-bom-data-slider">
        <div class="no-bom-icon-slider">üìã</div>
        <h3>No BOM Data Available</h3>
        <p>No bill of materials configured for current settings.</p>
        <p>Check station configuration in admin panel.</p>
    </div>
    {% endif %}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('.bom-table-slider');
            const container = document.querySelector('.bom-table-container-slider');
            
            if (table && container) {
                // Count columns
                const headerCells = table.querySelectorAll('thead th');
                const columnCount = headerCells.length;
                table.classList.add('cols-' + columnCount);
                
                // Count rows
                const dataRows = table.querySelectorAll('tbody tr');
                const rowCount = dataRows.length;
                container.setAttribute('data-row-count', rowCount);
                
                // Set CSS custom property for row calculation
                document.documentElement.style.setProperty('--row-count', rowCount);
                
                console.log('BOM Table initialized:', {
                    columns: columnCount,
                    rows: rowCount,
                    display: {{ station.display_number }},
                    is_split: {{ is_split|yesno:"true,false" }}
                });
            }
        });
    </script>
</div>